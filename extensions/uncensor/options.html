<!DOCTYPE html>
<!--
 * Copyright (C) 2011 House of Life Property ltd.
 * Copyright (C) 2011 Crystalnix <vgachkaylo@crystalnix.com>
-->
<html>
<head><title>Uncensor filter options</title>
<script type="text/javascript">

// return the value of the radio button that is checked
// return an empty string if none are checked, or
// there are no radio buttons
function getCheckedValue(radioObj) {
	if(!radioObj)
		return "";
	var radioLength = radioObj.length;
	if(radioLength == undefined)
		if(radioObj.checked)
			return radioObj.value;
		else
			return "";
	for(var i = 0; i < radioLength; i++) {
		if(radioObj[i].checked) {
			return radioObj[i].value;
		}
	}
	return "";
}

// set the radio button with the given value as being checked
// do nothing if there are no radio buttons
// if the given value does not exist, all the radio buttons
// are reset to unchecked
function setCheckedValue(radioObj, newValue) {
	if(!radioObj)
		return;
	var radioLength = radioObj.length;
	if(radioLength == undefined) {
		radioObj.checked = (radioObj.value == newValue.toString());
		return;
	}
	for(var i = 0; i < radioLength; i++) {
		radioObj[i].checked = false;
		if(radioObj[i].value == newValue.toString()) {
			radioObj[i].checked = true;
		}
	}
}

function save() {
  var prefs = JSON.parse(localStorage.prefs);
  prefs.shouldRedirect = (getCheckedValue(document.uncensor_form.shouldRedirect) == "1");
  prefs.showMessage = document.uncensor_form.showMessage.checked;
  prefs.notifyUpdate = document.uncensor_form.notifyUpdate.checked;
  localStorage.prefs = JSON.stringify(prefs);
}

// Make sure the checkbox checked state gets properly initialized from the
// saved preference.
window.onload = function() {
  var prefs = JSON.parse(localStorage.prefs);
  setCheckedValue(document.uncensor_form.shouldRedirect, prefs.shouldRedirect ? "1" : "0");
  document.uncensor_form.showMessage.checked = prefs.showMessage;
  document.uncensor_form.notifyUpdate.checked = prefs.notifyUpdate;
  var table = document.getElementById("domain_filter_table");
  var rowIndex = 1;
  for (var originalDomain in prefs.domainFilter) {
    var newRow = table.children[1].insertRow(-1);
    newRow.onmouseover = function () { this.className = 'highlight'; };
    newRow.onmouseout = function() { this.className = ''; };
    
    var oCell = newRow.insertCell(-1);
    oCell.innerHTML = "<img src='web.png' width='16' height='16' alt='' />";
    oCell.vAlign = "middle";
    oCell.style.width = "20px";
    
    oCell = newRow.insertCell(-1);
    oCell.innerHTML = originalDomain;
    oCell.style.width = "50%";

    oCell = newRow.insertCell(-1);
    oCell.innerHTML = prefs.domainFilter[originalDomain];
    oCell.style.width = "50%";
    
    anchor = document.createElement('a');
    anchor.href = "javascript:void(0)";
    anchor.className = "delete-icon";
    anchor.title = 'Exclude domains. Moves highlighted domain pair to exceptions list.'
    anchor.domainKey = originalDomain;
    anchor.rowIndex = rowIndex;
    icon = document.createElement('img');
    icon.src = "delete.png";
    icon.vAlign = "middle";
    icon.width = "16";
    icon.height = "16";
    anchor.appendChild(icon);
    
    anchor.onclick = function() { 
      table.deleteRow(this.rowIndex);
      delete prefs.domainFilter[this.domainKey];
      localStorage.prefs = JSON.stringify(prefs);
    };
    
    oCell.appendChild(anchor);    
    
    rowIndex++;
  }
}

</script>

<style type="text/css">
html, body {
  margin: 0;
  padding: 0;
}

body {
  cursor: default;
  font-size: 13px;
}

.page h1 {
  -webkit-user-select: none;
  color: #53637d;
  font-size: 200%;
  font-weight: normal;
  margin: 0;
  padding-top: 13px;  
  padding-bottom: 4px;
  text-shadow: white 0 1px 2px;
}

.page > h3 {
  -webkit-padding-end: 24px;
  border-bottom: 1px solid #eeeeee;
  font-size: 100%;  
  color: #53637d;
  font-weight: normal;
  margin: 0;
  padding-bottom: 4px;
}

section {
-webkit-box-orient: horizontal;
border-bottom: 1px solid #EEE;
display: -webkit-box;
margin-top: 17px;
padding-bottom: 20px;
}

section > h3 {
font-size: 105%;
font-weight: bold;
margin: 0;
vertical-align: middle;
width: 140px;
}

section > div:only-of-type {
-webkit-box-flex: 1;
}

div.checkbox, div.radio {
margin: 5px 0;
}

.page table {
  border-collapse: collapse;
  border: 1px solid #ccc;
  width: 80%;
}

.page table th {
  padding: 5px 10px;
  text-align: left;
}

.page table th + th {
  padding: 5px;
  width: 50%;
}

.page table td {
  padding: 2px 3px;
  text-align: left;
}

.page table thead tr {
  display:block;
  position:relative;
}

.page table tbody {
  display:block;
  width:100%;
  height:200px;
  overflow:auto;
}

.highlight {
  background-color: #ddf;
}

.delete-icon {
  display: none;
  float: right;
}

.highlight .delete-icon {
  display: block;
}

</style>

</head>
<body class="page" style="font-family: Helvetica, sans-serif; ">
  <h1>Uncensor filter</h1>
  <h3>BitPop will redirect you to new locations of unlawfully censored sites</h3>
  <form name="uncensor_form">
    <section>
      <h3>Filter control</h3>
      <div>
        <div class="radio">
          <label><input type="radio" name="shouldRedirect" value="1"> Always redirect / ON </label>
        </div>
        <div class="radio">
          <label><input type="radio" name="shouldRedirect" value="0"> Never redirect / OFF </label>
        </div>
      </div>
    </section>
    <section>
      <h3>Notices</h3>
      <div>
        <div class="checkbox">
          <label><input type="checkbox" name="showMessage"> Show message when redirected </label>
        </div>
        <div class="checkbox">
          <label><input type="checkbox" name="notifyUpdate"> Be notified when list updates </label>
        </div>
      </div>
    </section>
    <section>
      <h3>The filter</h3>
      <div>
        <table id="domain_filter_table">
          <thead><tr>
            <th></th>
            <th>Original domain</th>
            <th>New location</th>
          </tr></thead>          
          <tbody style="display:block; width:100%; height:200px; overflow:auto">
          </tbody>
        </table>
      </div>
    </section>
  </form>
  <section>
    <h3>Exceptions</h3>
    <div>
      <table id="domain_exceptions_table">
        <thead><tr>
          <th></th>
          <th>Original domain</th>
          <th>New location</th>
        </tr></thead>          
        <tbody style="display:block; width:100%; height:200px; overflow:auto">
        </tbody>
      </table>
    </div>
  </section>
</html>